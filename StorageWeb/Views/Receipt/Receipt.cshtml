@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    @using StorageWeb.Repository.Receipt.Models
}
@model ReceiptViewModel

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<h2>Ресурсы</h2>

<style>
    table {
        border-collapse: collapse;
        width: 40%;
        text-align: center;
    }
    td, th {
        border: 1px solid black;
        padding: 3px;
    }
	.select2-selection__choice {
        font-size: 6pt !important;
    }
</style>

<form method="get" style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 20px; flex-wrap: wrap;">
    <div>
        <label>Период</label><br />
        <input type="date" name="startDate" value="@Model.SelectedStartDate?.ToString("yyyy-MM-dd")" style="padding: 5px;" />
        <input type="date" name="endDate" value="@Model.SelectedEndDate?.ToString("yyyy-MM-dd")" style="padding: 5px;" />
        
        <div style="margin-top: 8px;">
            <button type="submit" style="background-color: #b02a37; color: white; border: none; padding: 6px 12px; border-radius: 4px;">
                Применить
            </button>
			<button type="button" onclick="window.location='/receipts/add'" style="background-color: #198754; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-left: 10px;">
                Добавить
            </button>
        </div>
    </div>

    <div>
        <label>Номер поступления</label><br />
        <select name="receiptNumber" multiple="multiple" id="receiptNumbers" style="width: 200px;">
            @foreach (var number in Model.Numbers)
            {
                <option value="@number" @(Model.SelectedNumbers.Contains(number.ToString()) ? "selected" : "")>@number</option>
            }
        </select>
    </div>

    <div>
        <label>Ресурс</label><br />
        <select name="resource" multiple="multiple" id="resources" style="width: 200px;">
            @foreach (var resource in Model.Resources)
            {
                <option value="@resource" @(Model.SelectedResources.Contains(resource) ? "selected" : "")>@resource</option>
            }
        </select>
    </div>

    <div>
        <label>Единица измерения</label><br />
        <select name="unit" multiple="multiple" id="units" style="width: 200px;">
            @foreach (var unit in Model.Units)
            {
                <option value="@unit" @(Model.SelectedUnits.Contains(unit) ? "selected" : "")>@unit</option>
            }
        </select>
    </div>
</form>
<table>
    <thead>
        <tr>
            <th>Номер</th>
            <th>Дата</th>
            <th>Ресурс</th>
            <th>Единица</th>
            <th>Количество</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var group in Model.Receipts.GroupBy(r => new { r.Number, r.Date }))
        {
            bool firstRow = true;
            int rowCount = group.Count();
            foreach (var receipt in group)
            {
                <tr>
                    @if (firstRow)
                    {
                        <td rowspan="@rowCount">@receipt.Number</td>
                        <td rowspan="@rowCount">@receipt.Date.ToString("dd.MM.yyyy")</td>
                        firstRow = false;
                    }
                    <td>@receipt.ReceiptResource</td>
                    <td>@receipt.ResourceUnit</td>
                    <td>@receipt.Count</td>
                </tr>
            }
        }
    </tbody>
</table>

<script>
    $(document).ready(function () {
        $('#receiptNumbers, #resources, #units').select2({
            placeholder: "Выберите",
            allowClear: true
        });
    });
</script>
